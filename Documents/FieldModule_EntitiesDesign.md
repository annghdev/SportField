# Thi·∫øt k·∫ø Chi ti·∫øt c√°c Th·ª±c th·ªÉ (Entities) - H·ªá th·ªëng Qu·∫£n l√Ω S√¢n Th·ªÉ thao

## üèóÔ∏è Ki·∫øn tr√∫c chung

### Ph√¢n c·∫•p k·∫ø th·ª´a
```
BaseEntity<T> (Generic base)
‚îú‚îÄ‚îÄ BaseEntity (Guid-based)
‚îî‚îÄ‚îÄ AuditableEntity<T> (Generic aggregate)
    ‚îî‚îÄ‚îÄ AuditableEntity (Guid-based)
        ‚îú‚îÄ‚îÄ Field (IAggregateRoot)
        ‚îú‚îÄ‚îÄ Facility (IAggregateRoot)
        ‚îî‚îÄ‚îÄ TimeSlot (IAggregateRoot)
```

### BaseEntity - L·ªõp c∆° s·ªü cho t·∫•t c·∫£ entities
**M·ª•c ƒë√≠ch**: Cung c·∫•p c√°c t√≠nh nƒÉng chung cho m·ªçi th·ª±c th·ªÉ trong h·ªá th·ªëng

**C√°c tr∆∞·ªùng d·ªØ li·ªáu:**
- `Id`: Kh√≥a ch√≠nh duy nh·∫•t (Guid.CreateVersion7() - UUID v7 c√≥ th·ª© t·ª± th·ªùi gian)
- `DomainEvents`: Danh s√°ch c√°c s·ª± ki·ªán mi·ªÅn ƒë·ªÉ x·ª≠ l√Ω nghi·ªáp v·ª• b·∫•t ƒë·ªìng b·ªô

### AuditableEntity
**M·ª•c ƒë√≠ch**: Qu·∫£n l√Ω audit trail v√† ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n d·ªØ li·ªáu

**C√°c tr∆∞·ªùng d·ªØ li·ªáu:**
- `CreatedDate`: Th·ªùi gian t·∫°o b·∫£n ghi (UTC)
- `CreatedBy`: ID ng∆∞·ªùi t·∫°o b·∫£n ghi 
- `ModifiedDate`: Th·ªùi gian c·∫≠p nh·∫≠t cu·ªëi c√πng (UTC)
- `ModifiedBy`: ID ng∆∞·ªùi c·∫≠p nh·∫≠t cu·ªëi c√πng
- `DeletedDate`: Th·ªùi gian x√≥a m·ªÅm (soft delete)

---

## üè¢ Facility - C∆° s·ªü th·ªÉ thao

**M·ª•c ƒë√≠ch**: ƒê·∫°i di·ªán cho m·ªôt c∆° s·ªü th·ªÉ thao (trung t√¢m, s√¢n b√≥ng, c√¢u l·∫°c b·ªô) ch·ª©a nhi·ªÅu s√¢n

### C√°c tr∆∞·ªùng d·ªØ li·ªáu chi ti·∫øt:

#### Th√¥ng tin c∆° b·∫£n
- **`Name`** (required string): T√™n c∆° s·ªü
  - *V√≠ d·ª•*: "S√¢n b√≥ng ThƒÉng Long", "Trung t√¢m th·ªÉ thao M·ªπ ƒê√¨nh"
  - *S·ª≠ d·ª•ng*: Hi·ªÉn th·ªã trong danh s√°ch, t√¨m ki·∫øm c∆° s·ªü

- **`Address`** (required string): ƒê·ªãa ch·ªâ ƒë·∫ßy ƒë·ªß
  - *V√≠ d·ª•*: "123 ƒê∆∞·ªùng ABC, Ph∆∞·ªùng XYZ, Qu·∫≠n 1, TP.HCM"
  - *S·ª≠ d·ª•ng*: Hi·ªÉn th·ªã cho kh√°ch h√†ng, t√≠ch h·ª£p b·∫£n ƒë·ªì, giao h√†ng

#### Th√¥ng tin li√™n h·ªá
- **`PhoneNumber`** (string?): S·ªë ƒëi·ªán tho·∫°i li√™n h·ªá
  - *V√≠ d·ª•*: "0901234567", "+84-28-12345678"
  - *S·ª≠ d·ª•ng*: Kh√°ch h√†ng g·ªçi ƒë·∫∑t s√¢n, x√°c nh·∫≠n booking

- **`Email`** (string?): Email li√™n h·ªá
  - *V√≠ d·ª•*: "info@sanbanh.com"
  - *S·ª≠ d·ª•ng*: G·ª≠i th√¥ng b√°o, x√°c nh·∫≠n booking qua email

- **`Description`** (string?): M√¥ t·∫£ chi ti·∫øt c∆° s·ªü
  - *V√≠ d·ª•*: "C∆° s·ªü hi·ªán ƒë·∫°i v·ªõi 5 s√¢n b√≥ng ƒë√° mini, c√≥ ch·ªó ƒë·ªÉ xe mi·ªÖn ph√≠"
  - *S·ª≠ d·ª•ng*: Marketing, hi·ªÉn th·ªã th√¥ng tin cho kh√°ch h√†ng

#### Th·ªùi gian ho·∫°t ƒë·ªông
- **`OpenTime`** (TimeOnly): Gi·ªù m·ªü c·ª≠a chung c·ªßa c∆° s·ªü
  - *M·∫∑c ƒë·ªãnh*: 6:00 AM
  - *S·ª≠ d·ª•ng*: R√†ng bu·ªôc gi·ªù ho·∫°t ƒë·ªông c·ªßa c√°c s√¢n con

- **`CloseTime`** (TimeOnly): Gi·ªù ƒë√≥ng c·ª≠a chung c·ªßa c∆° s·ªü  
  - *M·∫∑c ƒë·ªãnh*: 10:00 PM
  - *S·ª≠ d·ª•ng*: R√†ng bu·ªôc gi·ªù ho·∫°t ƒë·ªông c·ªßa c√°c s√¢n con

#### Qu·∫£n l√Ω
- **`IsActive`** (bool): Tr·∫°ng th√°i ho·∫°t ƒë·ªông
  - *M·∫∑c ƒë·ªãnh*: true
  - *S·ª≠ d·ª•ng*: T·∫°m ng∆∞ng ho·∫°t ƒë·ªông to√†n b·ªô c∆° s·ªü (b·∫£o tr√¨, ƒë√≥ng c·ª≠a)

- **`ManagerId`** (string?): ID c·ªßa ng∆∞·ªùi qu·∫£n l√Ω c∆° s·ªü
  - *S·ª≠ d·ª•ng*: Ph√¢n quy·ªÅn qu·∫£n l√Ω, li√™n h·ªá khi c√≥ v·∫•n ƒë·ªÅ

#### Navigation Properties
- **`Fields`**: Danh s√°ch c√°c s√¢n thu·ªôc c∆° s·ªü n√†y
  - *Quan h·ªá*: One-to-Many v·ªõi Field

---

## ‚öΩ Field - S√¢n th·ªÉ thao

**M·ª•c ƒë√≠ch**: ƒê·∫°i di·ªán cho m·ªôt s√¢n c·ª• th·ªÉ trong c∆° s·ªü (s√¢n b√≥ng ƒë√°, s√¢n c·∫ßu l√¥ng, s√¢n tennis...)

### C√°c tr∆∞·ªùng d·ªØ li·ªáu chi ti·∫øt:

#### Th√¥ng tin c∆° b·∫£n
- **`Name`** (required string): T√™n s√¢n
  - *V√≠ d·ª•*: "S√¢n A", "S√¢n b√≥ng ƒë√° 1", "S√¢n c·∫ßu l√¥ng VIP"
  - *S·ª≠ d·ª•ng*: Ph√¢n bi·ªát c√°c s√¢n, hi·ªÉn th·ªã trong booking

- **`FacilityId`** (required string): ID c∆° s·ªü ch·ª©a s√¢n n√†y
  - *S·ª≠ d·ª•ng*: Li√™n k·∫øt v·ªõi Facility, group theo c∆° s·ªü

- **`Type`** (FieldType enum): Lo·∫°i s√¢n
  - *C√°c gi√° tr·ªã*: Football5v5, Football7v7, Football11v11, Badminton, Tennis, Basketball...
  - *S·ª≠ d·ª•ng*: L·ªçc s√¢n theo m√¥n th·ªÉ thao, t√≠nh gi√° kh√°c nhau

- **`BasePrice`** (decimal): Gi√° c∆° b·∫£n m·ªói gi·ªù
  - *V√≠ d·ª•*: 200000 (200k VNƒê/gi·ªù)
  - *S·ª≠ d·ª•ng*: Gi√° n·ªÅn tr∆∞·ªõc khi √°p d·ª•ng pricing rules ph·ª©c t·∫°p

#### M√¥ t·∫£ v√† c·∫•u h√¨nh
- **`Description`** (string?): M√¥ t·∫£ chi ti·∫øt s√¢n
  - *V√≠ d·ª•*: "S√¢n c·ªè nh√¢n t·∫°o 5v5, c√≥ m√°i che, ƒë√®n chi·∫øu s√°ng"
  - *S·ª≠ d·ª•ng*: Hi·ªÉn th·ªã th√¥ng tin cho kh√°ch h√†ng

- **`Capacity`** (int): S·ªë ng∆∞·ªùi t·ªëi ƒëa
  - *M·∫∑c ƒë·ªãnh*: 10 ng∆∞·ªùi
  - *S·ª≠ d·ª•ng*: Ki·ªÉm so√°t s·ªë l∆∞·ª£ng ng∆∞·ªùi, t√≠nh ph√≠ theo nh√≥m

- **`IsActive`** (bool): Tr·∫°ng th√°i ho·∫°t ƒë·ªông
  - *M·∫∑c ƒë·ªãnh*: true
  - *S·ª≠ d·ª•ng*: T·∫°m ng∆∞ng s√¢n (b·∫£o tr√¨, h·ªèng h√≥c) m√† kh√¥ng x√≥a d·ªØ li·ªáu

#### Navigation Properties
- **`Facility`**: C∆° s·ªü ch·ª©a s√¢n n√†y
- **`TimeSlots`**: C√°c khung gi·ªù c√≥ th·ªÉ booking
- **`FieldPricings`**: B·∫£ng gi√° theo khung gi·ªù/ng√†y
- **`OperatingHours`**: Gi·ªù ho·∫°t ƒë·ªông theo t·ª´ng ng√†y trong tu·∫ßn
- **`MaintenanceSchedules`**: L·ªãch b·∫£o tr√¨
- **`BlockedAvailabilities`**: C√°c kho·∫£ng th·ªùi gian b·ªã ch·∫∑n

---

## ‚è∞ TimeSlot - Khung th·ªùi gian

**M·ª•c ƒë√≠ch**: ƒê·ªãnh nghƒ©a c√°c kho·∫£ng th·ªùi gian c·ªë ƒë·ªãnh c√≥ th·ªÉ ƒë·∫∑t s√¢n

### **üö® Thay ƒë·ªïi quan tr·ªçng:**
- **`Id`** (string): S·ª≠ d·ª•ng **string** thay v√¨ Guid ƒë·ªÉ d·ªÖ d√†ng t·∫°o ID c√≥ √Ω nghƒ©a
  - *V√≠ d·ª•*: "06:00-07:00", "14:30-16:00", "evening-slot-1"
  - *L·ª£i √≠ch*: D·ªÖ debug, d·ªÖ hi·ªÉu, c√≥ th·ªÉ t·∫°o ID c√≥ pattern

### C√°c tr∆∞·ªùng d·ªØ li·ªáu chi ti·∫øt:

- **`StartTime`** (TimeOnly): Th·ªùi gian b·∫Øt ƒë·∫ßu
  - *V√≠ d·ª•*: 08:00, 14:30, 20:00
  - *S·ª≠ d·ª•ng*: X√°c ƒë·ªãnh th·ªùi ƒëi·ªÉm b·∫Øt ƒë·∫ßu slot

- **`EndTime`** (TimeOnly): Th·ªùi gian k·∫øt th√∫c  
  - *V√≠ d·ª•*: 09:00, 15:30, 21:00
  - *S·ª≠ d·ª•ng*: X√°c ƒë·ªãnh th·ªùi ƒëi·ªÉm k·∫øt th√∫c slot

- **`DurationInMinutes`** (int): Th·ªùi l∆∞·ª£ng t√≠nh b·∫±ng ph√∫t
  - *T·ª± ƒë·ªông t√≠nh*: EndTime - StartTime
  - *V√≠ d·ª•*: 60, 90, 120 ph√∫t
  - *S·ª≠ d·ª•ng*: T√≠nh to√°n gi√° ti·ªÅn, hi·ªÉn th·ªã th√¥ng tin

- **`IsActive`** (bool): Tr·∫°ng th√°i k√≠ch ho·∫°t
  - *M·∫∑c ƒë·ªãnh*: true
  - *S·ª≠ d·ª•ng*: V√¥ hi·ªáu h√≥a slot kh√¥ng c√≤n s·ª≠ d·ª•ng

### Factory Methods:
- **`Create(startTime, endTime)`**: T·∫°o v·ªõi ID t·ª± ƒë·ªông (Guid)
- **`CreateWithId(id, startTime, endTime)`**: T·∫°o v·ªõi ID t√πy ch·ªânh (string)

### Ph∆∞∆°ng th·ª©c h·ªó tr·ª£:
- **`GetDisplayName()`**: Hi·ªÉn th·ªã d·∫°ng "08:00 - 09:00"
- **`IsOverlapping()`**: Ki·ªÉm tra tr√πng l·∫∑p v·ªõi slot kh√°c

---

## üí∞ FieldPricing - B·∫£ng gi√° s√¢n

**M·ª•c ƒë√≠ch**: Qu·∫£n l√Ω gi√° s√¢n theo khung gi·ªù, ng√†y trong tu·∫ßn v√† th·ªùi gian c√≥ hi·ªáu l·ª±c

### **üö® Thay ƒë·ªïi quan tr·ªçng:**
- **`TimeSlotId`** (string): ƒê√£ thay ƒë·ªïi t·ª´ Guid th√†nh **string** ƒë·ªÉ ph√π h·ª£p v·ªõi TimeSlot.Id

### C√°c tr∆∞·ªùng d·ªØ li·ªáu chi ti·∫øt:

#### Li√™n k·∫øt
- **`FieldId`** (Guid): ID s√¢n √°p d·ª•ng gi√° n√†y
- **`TimeSlotId`** (required string): ID khung gi·ªù √°p d·ª•ng - **üÜï ƒê√£ chuy·ªÉn th√†nh string**
  - *S·ª≠ d·ª•ng*: M·ªôt slot c√≥ th·ªÉ c√≥ gi√° kh√°c nhau theo ng√†y, th·ªùi gian

#### Gi√° v√† th·ªùi gian √°p d·ª•ng
- **`Price`** (decimal): Gi√° ti·ªÅn cho slot n√†y
  - *V√≠ d·ª•*: 250000 (250k VNƒê)
  - *S·ª≠ d·ª•ng*: Ghi ƒë√® BasePrice c·ªßa Field

- **`DayOfWeek`** (DayOfWeek?): Ng√†y trong tu·∫ßn √°p d·ª•ng
  - *null*: √Åp d·ª•ng cho t·∫•t c·∫£ c√°c ng√†y
  - *V√≠ d·ª•*: Monday, Saturday, Sunday
  - *S·ª≠ d·ª•ng*: Gi√° cu·ªëi tu·∫ßn kh√°c gi√° ng√†y th∆∞·ªùng

#### Th·ªùi gian hi·ªáu l·ª±c
- **`EffectiveFrom`** (DateTime?): Ng√†y b·∫Øt ƒë·∫ßu c√≥ hi·ªáu l·ª±c
  - *null*: C√≥ hi·ªáu l·ª±c ngay l·∫≠p t·ª©c
  - *V√≠ d·ª•*: 2024-01-01 (b·∫Øt ƒë·∫ßu t·ª´ nƒÉm m·ªõi)
  - *S·ª≠ d·ª•ng*: L√™n l·ªãch tƒÉng gi√°, khuy·∫øn m√£i

- **`EffectiveTo`** (DateTime?): Ng√†y h·∫øt hi·ªáu l·ª±c
  - *null*: C√≥ hi·ªáu l·ª±c v√¥ th·ªùi h·∫°n
  - *V√≠ d·ª•*: 2024-01-31 (ch·ªâ √°p d·ª•ng trong th√°ng 1)
  - *S·ª≠ d·ª•ng*: Khuy·∫øn m√£i c√≥ th·ªùi h·∫°n

- **`IsActive`** (bool): Tr·∫°ng th√°i k√≠ch ho·∫°t
  - *M·∫∑c ƒë·ªãnh*: true
  - *S·ª≠ d·ª•ng*: V√¥ hi·ªáu h√≥a pricing rule m√† kh√¥ng x√≥a

### Navigation Properties
- **`Field`**: S√¢n √°p d·ª•ng b·∫£ng gi√°
- **`TimeSlot`**: Khung gi·ªù √°p d·ª•ng b·∫£ng gi√°

### Ph∆∞∆°ng th·ª©c h·ªó tr·ª£:
- **`IsValidForDate(DateTime date)`**: Ki·ªÉm tra b·∫£ng gi√° c√≥ √°p d·ª•ng cho ng√†y c·ª• th·ªÉ

---

## üïê FieldOperatingHours - Gi·ªù ho·∫°t ƒë·ªông s√¢n

**M·ª•c ƒë√≠ch**: Qu·∫£n l√Ω gi·ªù m·ªü/ƒë√≥ng c·ª≠a c·ªßa s√¢n theo t·ª´ng ng√†y trong tu·∫ßn

### C√°c tr∆∞·ªùng d·ªØ li·ªáu chi ti·∫øt:

#### Li√™n k·∫øt v√† th·ªùi gian
- **`FieldId`** (required Guid): ID s√¢n √°p d·ª•ng
- **`DayOfWeek`** (DayOfWeek): Ng√†y trong tu·∫ßn
  - *V√≠ d·ª•*: Monday, Tuesday, Sunday
  - *S·ª≠ d·ª•ng*: M·ªói ng√†y c√≥ th·ªÉ c√≥ gi·ªù ho·∫°t ƒë·ªông kh√°c nhau

- **`OpenTime`** (TimeOnly): Gi·ªù m·ªü c·ª≠a
  - *V√≠ d·ª•*: 06:00, 07:00
  - *S·ª≠ d·ª•ng*: Gi·ªõi h·∫°n booking t·ª´ gi·ªù n√†y

- **`CloseTime`** (TimeOnly): Gi·ªù ƒë√≥ng c·ª≠a
  - *V√≠ d·ª•*: 22:00, 23:00
  - *S·ª≠ d·ª•ng*: Gi·ªõi h·∫°n booking ƒë·∫øn gi·ªù n√†y

#### Tr·∫°ng th√°i ho·∫°t ƒë·ªông
- **`IsActive`** (bool): K√≠ch ho·∫°t gi·ªù ho·∫°t ƒë·ªông
  - *M·∫∑c ƒë·ªãnh*: true
  - *S·ª≠ d·ª•ng*: V√¥ hi·ªáu h√≥a t·∫°m th·ªùi

- **`IsClosed`** (bool): ƒê√≥ng c·ª≠a ho√†n to√†n trong ng√†y
  - *M·∫∑c ƒë·ªãnh*: false
  - *S·ª≠ d·ª•ng*: ƒê√≥ng c·ª≠a ƒë·ªôt xu·∫•t (b·∫£o tr√¨, s·ª± c·ªë)

- **`Notes`** (string?): Ghi ch√∫
  - *V√≠ d·ª•*: "ƒê√≥ng c·ª≠a do m∆∞a l·ªõn", "B·∫£o tr√¨ ƒë·ªãnh k·ª≥"
  - *S·ª≠ d·ª•ng*: Th√¥ng tin cho kh√°ch h√†ng

### Navigation Properties
- **`Field`**: S√¢n √°p d·ª•ng gi·ªù ho·∫°t ƒë·ªông

### Ph∆∞∆°ng th·ª©c h·ªó tr·ª£:
- **`IsWithinOperatingHours(TimeOnly time)`**: Ki·ªÉm tra th·ªùi gian c√≥ trong gi·ªù ho·∫°t ƒë·ªông
- **`IsOperatingOnDate(DateTime date)`**: Ki·ªÉm tra c√≥ ho·∫°t ƒë·ªông v√†o ng√†y c·ª• th·ªÉ
- **`GetOperatingDuration()`**: T√≠nh t·ªïng th·ªùi gian ho·∫°t ƒë·ªông trong ng√†y

---

## üîß FieldMaintenance - B·∫£o tr√¨ s√¢n

**M·ª•c ƒë√≠ch**: L·∫≠p l·ªãch v√† theo d√µi c√°c ho·∫°t ƒë·ªông b·∫£o tr√¨, s·ª≠a ch·ªØa s√¢n

### C√°c tr∆∞·ªùng d·ªØ li·ªáu chi ti·∫øt:

#### Th√¥ng tin c∆° b·∫£n
- **`FieldId`** (Guid): ID s√¢n c·∫ßn b·∫£o tr√¨
- **`Title`** (string): Ti√™u ƒë·ªÅ c√¥ng vi·ªác b·∫£o tr√¨
  - *V√≠ d·ª•*: "Thay c·ªè nh√¢n t·∫°o", "S·ª≠a h·ªá th·ªëng ƒë√®n"
  - *S·ª≠ d·ª•ng*: M√¥ t·∫£ ng·∫Øn g·ªçn c√¥ng vi·ªác

- **`Description`** (string?): M√¥ t·∫£ chi ti·∫øt
  - *V√≠ d·ª•*: "Thay to√†n b·ªô c·ªè nh√¢n t·∫°o khu v·ª±c khung th√†nh do b·ªã m√≤n"
  - *S·ª≠ d·ª•ng*: H∆∞·ªõng d·∫´n chi ti·∫øt cho k·ªπ thu·∫≠t vi√™n

#### Th·ªùi gian th·ª±c hi·ªán
- **`StartTime`** (DateTime): Th·ªùi gian b·∫Øt ƒë·∫ßu b·∫£o tr√¨
  - *S·ª≠ d·ª•ng*: Ch·∫∑n booking t·ª´ th·ªùi ƒëi·ªÉm n√†y

- **`EndTime`** (DateTime): Th·ªùi gian k·∫øt th√∫c d·ª± ki·∫øn
  - *S·ª≠ d·ª•ng*: M·ªü l·∫°i booking sau th·ªùi ƒëi·ªÉm n√†y

#### Tr·∫°ng th√°i v√† ph√¢n lo·∫°i
- **`Status`** (MaintenanceStatus enum): Tr·∫°ng th√°i hi·ªán t·∫°i
  - *C√°c gi√° tr·ªã*: Scheduled, InProgress, Completed, Cancelled
  - *S·ª≠ d·ª•ng*: Workflow qu·∫£n l√Ω c√¥ng vi·ªác

- **`Type`** (MaintenanceType enum): Lo·∫°i b·∫£o tr√¨
  - *C√°c gi√° tr·ªã*: Preventive, Corrective, Emergency, Upgrade
  - *S·ª≠ d·ª•ng*: Ph√¢n lo·∫°i ƒë·ªÉ th·ªëng k√™, b√°o c√°o

#### Ph√¢n c√¥ng v√† chi ph√≠
- **`AssignedTo`** (string?): ID ng∆∞·ªùi ƒë∆∞·ª£c giao vi·ªác
  - *S·ª≠ d·ª•ng*: Theo d√µi tr√°ch nhi·ªám, li√™n h·ªá

- **`EstimatedCost`** (decimal?): Chi ph√≠ ∆∞·ªõc t√≠nh
  - *S·ª≠ d·ª•ng*: L·∫≠p k·∫ø ho·∫°ch ng√¢n s√°ch

- **`ActualCost`** (decimal?): Chi ph√≠ th·ª±c t·∫ø
  - *S·ª≠ d·ª•ng*: Theo d√µi chi ph√≠, b√°o c√°o

- **`Notes`** (string?): Ghi ch√∫ b·ªï sung
  - *S·ª≠ d·ª•ng*: L∆∞u th√¥ng tin ph√°t sinh, k·∫øt qu·∫£ th·ª±c hi·ªán

#### B·∫£o tr√¨ ƒë·ªãnh k·ª≥
- **`IsRecurring`** (bool): C√≥ ph·∫£i b·∫£o tr√¨ ƒë·ªãnh k·ª≥
  - *S·ª≠ d·ª•ng*: T·ª± ƒë·ªông t·∫°o l·ªãch b·∫£o tr√¨ ti·∫øp theo

- **`RecurrencePattern`** (string?): M·∫´u l·∫∑p l·∫°i (JSON)
  - *V√≠ d·ª•*: {"interval": "monthly", "day": 15} (ng√†y 15 h√†ng th√°ng)
  - *S·ª≠ d·ª•ng*: C·∫•u h√¨nh chu k·ª≥ b·∫£o tr√¨

### Navigation Properties
- **`Field`**: S√¢n ƒë∆∞·ª£c b·∫£o tr√¨

### Ph∆∞∆°ng th·ª©c h·ªó tr·ª£:
- **`IsActiveOnDate(DateTime date)`**: Ki·ªÉm tra c√≥ b·∫£o tr√¨ v√†o ng√†y c·ª• th·ªÉ
- **`ConflictsWith(DateTime start, DateTime end)`**: Ki·ªÉm tra xung ƒë·ªôt th·ªùi gian
- **`GetDuration()`**: T√≠nh th·ªùi gian b·∫£o tr√¨

---

## üö´ FieldAvailability - Ch·∫∑n l·ªãch s√¢n

**M·ª•c ƒë√≠ch**: Ch·∫∑n c√°c khung th·ªùi gian kh√¥ng cho ph√©p booking (s·ª± ki·ªán ƒë·∫∑c bi·ªát, reserved...)

### **üö® Thay ƒë·ªïi quan tr·ªçng:**
- **`TimeSlotId`** (string): ƒê√£ thay ƒë·ªïi t·ª´ Guid th√†nh **string** ƒë·ªÉ ph√π h·ª£p v·ªõi TimeSlot.Id

### C√°c tr∆∞·ªùng d·ªØ li·ªáu chi ti·∫øt:

#### Li√™n k·∫øt
- **`FieldId`** (Guid): ID s√¢n b·ªã ch·∫∑n
- **`TimeSlotId`** (required string): ID khung gi·ªù b·ªã ch·∫∑n - **üÜï ƒê√£ chuy·ªÉn th√†nh string**
  - *S·ª≠ d·ª•ng*: Ch·∫∑n ch√≠nh x√°c khung gi·ªù c·ª• th·ªÉ

#### Th·ªùi gian ch·∫∑n
- **`FromDate`** (DateTime): Ng√†y b·∫Øt ƒë·∫ßu ch·∫∑n
  - *S·ª≠ d·ª•ng*: Ch·∫∑n t·ª´ ng√†y n√†y

- **`ToDate`** (DateTime?): Ng√†y k·∫øt th√∫c ch·∫∑n
  - *null*: Ch·∫∑n v√¥ th·ªùi h·∫°n
  - *S·ª≠ d·ª•ng*: Ch·∫∑n ƒë·∫øn ng√†y n√†y, sau ƒë√≥ t·ª± ƒë·ªông m·ªü

#### Tr·∫°ng th√°i v√† l√Ω do
- **`IsBlocked`** (bool): C√≥ ƒëang b·ªã ch·∫∑n kh√¥ng
  - *M·∫∑c ƒë·ªãnh*: true
  - *S·ª≠ d·ª•ng*: C√≥ th·ªÉ m·ªü l·∫°i m√† kh√¥ng x√≥a record

- **`Reason`** (string?): L√Ω do ch·∫∑n
  - *V√≠ d·ª•*: "T·ªï ch·ª©c gi·∫£i b√≥ng ƒë√°", "Reserved cho VIP"
  - *S·ª≠ d·ª•ng*: Th√¥ng tin cho staff, kh√°ch h√†ng

### Navigation Properties
- **`Field`**: S√¢n b·ªã ch·∫∑n
- **`TimeSlot`**: Khung gi·ªù b·ªã ch·∫∑n

### Ph∆∞∆°ng th·ª©c h·ªó tr·ª£:
- **`IsBlockedOnDate(DateTime date)`**: Ki·ªÉm tra c√≥ b·ªã ch·∫∑n v√†o ng√†y c·ª• th·ªÉ

---

## üéØ Domain Events - Format m·ªõi

### **üö® Thay ƒë·ªïi quan tr·ªçng:**
T·∫•t c·∫£ Domain Events ƒë√£ ƒë∆∞·ª£c chuy·ªÉn sang **primary constructor record syntax** cho clean code:

```csharp
// C≈© (class v·ªõi constructor)
public class FieldCreatedEvent : BaseDomainEvent
{
    public Guid FieldId { get; }
    public string Name { get; }
    
    public FieldCreatedEvent(Guid fieldId, string name)
    {
        FieldId = fieldId;
        Name = name;
    }
}

// M·ªõi (record v·ªõi primary constructor)
public record FieldCreatedEvent(
    Guid FieldId,
    string Name,
    Guid FacilityId,
    FieldType Type
) : BaseDomainEvent;
```

### C√°c Domain Events hi·ªán c√≥:
- **`FieldCreatedEvent`**: Khi t·∫°o s√¢n m·ªõi
- **`FieldAvailableEvent`**: Khi s√¢n kh·∫£ d·ª•ng tr·ªü l·∫°i
- **`FieldUnavailableEvent`**: Khi s√¢n kh√¥ng kh·∫£ d·ª•ng
- **`FieldMaintenanceScheduledEvent`**: L√™n l·ªãch b·∫£o tr√¨
- **`FieldMaintenanceStartedEvent`**: B·∫Øt ƒë·∫ßu b·∫£o tr√¨
- **`FieldMaintenanceCompletedEvent`**: Ho√†n th√†nh b·∫£o tr√¨
- **`FieldMaintenanceCancelledEvent`**: H·ªßy b·∫£o tr√¨
- **`TimeSlotPriceUpdatedEvent`**: C·∫≠p nh·∫≠t gi√° slot
- **`FieldOperatingHoursUpdatedEvent`**: C·∫≠p nh·∫≠t gi·ªù ho·∫°t ƒë·ªông
- **`FieldClosedForDayEvent`**: ƒê√≥ng c·ª≠a trong ng√†y
- **`FieldOpenedForDayEvent`**: M·ªü c·ª≠a tr·ªü l·∫°i

---

## üîó M·ªëi quan h·ªá v√† t∆∞∆°ng t√°c gi·ªØa c√°c th·ª±c th·ªÉ

### Lu·ªìng nghi·ªáp v·ª• ch√≠nh:

1. **T·∫°o booking**: Check Field.IsActive ‚Üí FieldOperatingHours ‚Üí FieldAvailability ‚Üí FieldMaintenance
2. **T√≠nh gi√°**: Field.BasePrice ‚Üí FieldPricing (theo TimeSlot, DayOfWeek, th·ªùi gian)
3. **B·∫£o tr√¨**: T·∫°o FieldMaintenance ‚Üí Block Field t·ª± ƒë·ªông
4. **Qu·∫£n l√Ω c∆° s·ªü**: Facility qu·∫£n l√Ω nhi·ªÅu Field, m·ªói Field c√≥ c√°c th√¥ng tin ri√™ng

### R√†ng bu·ªôc nghi·ªáp v·ª•:
- Kh√¥ng ƒë∆∞·ª£c book s√¢n khi: IsActive = false, trong th·ªùi gian b·∫£o tr√¨, ngo√†i gi·ªù ho·∫°t ƒë·ªông, b·ªã block
- Gi√° s√¢n ƒë∆∞·ª£c ∆∞u ti√™n: FieldPricing (specific) > Field.BasePrice (general)
- Th·ªùi gian b·∫£o tr√¨ kh√¥ng ƒë∆∞·ª£c tr√πng l·∫∑p
- Gi·ªù ho·∫°t ƒë·ªông s√¢n ph·∫£i n·∫±m trong gi·ªù ho·∫°t ƒë·ªông c·ªßa c∆° s·ªü
- **TimeSlot.Id ph·∫£i unique** v√† c√≥ format nh·∫•t qu√°n trong h·ªá th·ªëng

### Migration Notes:
Khi update t·ª´ phi√™n b·∫£n c≈©:
1. **TimeSlot.Id**: Convert t·ª´ Guid sang string (c√≥ th·ªÉ gi·ªØ nguy√™n Guid string ho·∫∑c t·∫°o format m·ªõi)
2. **FieldPricing.TimeSlotId**: Update foreign key references
3. **FieldAvailability.TimeSlotId**: Update foreign key references
4. **Domain Events**: Chuy·ªÉn sang record syntax ƒë·ªÉ code cleaner
5. **AggregateRoot.DeletedDate**: Th√™m field m·ªõi cho soft delete tracking
